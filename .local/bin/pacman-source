#!/bin/bash -e

usage() {
  echo "Usage: pacman-source PACKAGE1 [PACKAGE2 ...]"
  echo "Example: pacman-source pacman"
  exit 1
}

if [ "$#" -lt 1 ]; then
  usage
fi

for PKG in "$@"; do
  pacman -Ss "^$PKG$" &> /dev/null || { echo "Invalid package."; continue; }

  rm -rfd "/tmp/$PKG"
  rm -rfd "/var/lib/pacman/sources/$PKG"

  git clone --depth 1 --progress "https://gitea.artixlinux.org/packages/$PKG.git" "/tmp/$PKG"

  cd "/tmp/$PKG" && vim .

  makepkg -do --skippgpcheck

  cd "/var/lib/pacman/sources/$PKG/src" && vim . && cd "/tmp/$PKG"

  makepkg -ersi --noconfirm --skippgpcheck
done
